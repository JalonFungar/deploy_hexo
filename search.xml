<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>mkfs.fat移植和使用</title>
      <link href="/2024/09/05/mkfs.fat-yi-zhi-he-shi-yong/"/>
      <url>/2024/09/05/mkfs.fat-yi-zhi-he-shi-yong/</url>
      
        <content type="html"><![CDATA[<blockquote><p>调试过程记录，尽可能用最简洁的话把原理说清楚。</p></blockquote><h1 id="mkfs-fat移植和使用"><a href="#mkfs-fat移植和使用" class="headerlink" title="mkfs.fat移植和使用"></a>mkfs.fat移植和使用</h1><h1 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a>一、引言</h1><h2 id="1-1、背景"><a href="#1-1、背景" class="headerlink" title="1.1、背景"></a>1.1、背景</h2><p>客户需求，需要在arm linux中格式化sd卡，格式化成fat格式。</p><h2 id="1-2、文章目的"><a href="#1-2、文章目的" class="headerlink" title="1.2、文章目的"></a>1.2、文章目的</h2><p>总结归档，输出快速可移植、可操作、可执行的指引文档。</p><p>如果不想看更多的内容，而是直接拿到板子上手使用，请移步到 使用指南 。</p><h1 id="二、项目概述"><a href="#二、项目概述" class="headerlink" title="二、项目概述"></a>二、项目概述</h1><h2 id="2-1、功能简介"><a href="#2-1、功能简介" class="headerlink" title="2.1、功能简介"></a>2.1、功能简介</h2><p>正常使用这个命令。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">mkfs.fat --help</span><br><span class="line">mkfs.fat 4.2 (2021-01-31)</span><br><span class="line">Usage: mkfs.fat [OPTIONS] TARGET [BLOCKS]</span><br><span class="line">Create FAT filesystem in TARGET, which can be a block device or file. Use only</span><br><span class="line">up to BLOCKS 1024 byte blocks if specified. With the -C option, file TARGET will be</span><br><span class="line">created with a size of 1024 bytes times BLOCKS, which must be specified.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -a              Disable alignment of data structures</span><br><span class="line">  -A              Toggle Atari variant of the filesystem</span><br><span class="line">  -b SECTOR       Select SECTOR as location of the FAT32 backup boot sector</span><br><span class="line">  -c              Check device for bad blocks before creating the filesystem</span><br><span class="line">  -C              Create file TARGET then create filesystem in it</span><br><span class="line">  -D NUMBER       Write BIOS drive number NUMBER to boot sector</span><br><span class="line">  -f COUNT        Create COUNT file allocation tables</span><br><span class="line">  -F SIZE         Select FAT size SIZE (12, 16 or 32)</span><br><span class="line">  -g GEOM         Select disk geometry: heads/sectors_per_track</span><br><span class="line">  -h NUMBER       Write hidden sectors NUMBER to boot sector</span><br><span class="line">  -i VOLID        Set volume ID to VOLID (a 32 bit hexadecimal number)</span><br><span class="line">  -I              Ignore and disable safety checks</span><br><span class="line">  -l FILENAME     Read bad blocks list from FILENAME</span><br><span class="line">  -m FILENAME     Replace default error message in boot block with contents of FILENAME</span><br><span class="line">  -M TYPE         Set media type in boot sector to TYPE</span><br><span class="line">  --mbr[=y|n|a]   Fill (fake) MBR table with one partition which spans whole disk</span><br><span class="line">  -n LABEL        Set volume name to LABEL (up to 11 characters long)</span><br><span class="line">  --codepage=N    use DOS codepage N to encode label (default: 850)</span><br><span class="line">  -r COUNT        Make room for at least COUNT entries in the root directory</span><br><span class="line">  -R COUNT        Set minimal number of reserved sectors to COUNT</span><br><span class="line">  -s COUNT        Set number of sectors per cluster to COUNT</span><br><span class="line">  -S SIZE         Select a sector size of SIZE (a power of two, at least 512)</span><br><span class="line">  -v              Verbose execution</span><br><span class="line">  --variant=TYPE  Select variant TYPE of filesystem (standard or Atari)</span><br><span class="line"></span><br><span class="line">  --invariant     Use constants for randomly generated or time based values</span><br><span class="line">  --offset=SECTOR Write the filesystem at a specific sector into the device file.</span><br><span class="line">  --help          Show this help message and exit</span><br></pre></td></tr></table></figure><h1 id="三、环境准备"><a href="#三、环境准备" class="headerlink" title="三、环境准备"></a>三、环境准备</h1><h2 id="3-1、产品需求"><a href="#3-1、产品需求" class="headerlink" title="3.1、产品需求"></a>3.1、产品需求</h2><p>支持 mkfs.fat这条命令</p><h2 id="3-2、硬件配置"><a href="#3-2、硬件配置" class="headerlink" title="3.2、硬件配置"></a>3.2、硬件配置</h2><p>1、任意ss928的板子，本次使用的是安防S4主板。</p><p>2、通过网口完成数据传输及命令行交互</p><h2 id="3-3、软件配置"><a href="#3-3、软件配置" class="headerlink" title="3.3、软件配置"></a>3.3、软件配置</h2><p>1、secureCRT工具（可选）</p><p>2、ssh等一些常用的网络调试工具</p><h1 id="四、实现要点"><a href="#四、实现要点" class="headerlink" title="四、实现要点"></a>四、实现要点</h1><h3 id="4-1、关键步骤"><a href="#4-1、关键步骤" class="headerlink" title="4.1、关键步骤"></a>4.1、关键步骤</h3><h4 id="1）下载源码交叉编译"><a href="#1）下载源码交叉编译" class="headerlink" title="1）下载源码交叉编译"></a>1）下载源码交叉编译</h4><p>详细请看如下命令行交互，所有操作都是在编译主机：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/dosfstools/dosfstools/archive/refs/tags/v4.2.tar.gz -O dosfstools-4.2.tar.gz</span><br><span class="line"></span><br><span class="line">tar -xf dosfstools-4.2.tar.gz</span><br><span class="line"><span class="built_in">cd</span> dosfstools-4.2</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> __install</span><br><span class="line"></span><br><span class="line">./autogen.sh</span><br><span class="line">./configure --host=aarch64-linux-gnu CC=aarch64-mix210-linux-gcc --prefix=$(<span class="built_in">pwd</span>)/__install</span><br><span class="line"></span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">scp -r __install root@192.168.0.224:/</span><br></pre></td></tr></table></figure><h4 id="2）板端更新文件"><a href="#2）板端更新文件" class="headerlink" title="2）板端更新文件"></a>2）板端更新文件</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /</span><br><span class="line"><span class="built_in">cd</span> __install/</span><br><span class="line"><span class="built_in">chmod</span> -R 777 sbin/</span><br><span class="line"><span class="built_in">cp</span> sbin/* /usr/sbin/</span><br><span class="line"></span><br><span class="line">mkfs.fat --<span class="built_in">help</span></span><br></pre></td></tr></table></figure><p>‍</p><h4 id="3）板端使用这个工具"><a href="#3）板端使用这个工具" class="headerlink" title="3）板端使用这个工具"></a>3）板端使用这个工具</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">mkfs.fat -v</span><br><span class="line">mkfs.fat 4.2 (2021-01-31)</span><br><span class="line">No device specified.</span><br><span class="line">Usage: mkfs.fat [OPTIONS] TARGET [BLOCKS]</span><br><span class="line">Create FAT filesystem <span class="keyword">in</span> TARGET, <span class="built_in">which</span> can be a block device or file. Use only</span><br><span class="line">up to BLOCKS 1024 byte blocks <span class="keyword">if</span> specified. With the -C option, file TARGET will be</span><br><span class="line">created with a size of 1024 bytes <span class="built_in">times</span> BLOCKS, <span class="built_in">which</span> must be specified.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -a              Disable alignment of data structures</span><br><span class="line">  -A              Toggle Atari variant of the filesystem</span><br><span class="line">  -b SECTOR       Select SECTOR as location of the FAT32 backup boot sector</span><br><span class="line">  -c              Check device <span class="keyword">for</span> bad blocks before creating the filesystem</span><br><span class="line">  -C              Create file TARGET <span class="keyword">then</span> create filesystem <span class="keyword">in</span> it</span><br><span class="line">  -D NUMBER       Write BIOS drive number NUMBER to boot sector</span><br><span class="line">  -f COUNT        Create COUNT file allocation tables</span><br><span class="line">  -F SIZE         Select FAT size SIZE (12, 16 or 32)</span><br><span class="line">  -g GEOM         Select disk geometry: heads/sectors_per_track</span><br><span class="line">  -h NUMBER       Write hidden sectors NUMBER to boot sector</span><br><span class="line">  -i VOLID        Set volume ID to VOLID (a 32 bit hexadecimal number)</span><br><span class="line">  -I              Ignore and <span class="built_in">disable</span> safety checks</span><br><span class="line">  -l FILENAME     Read bad blocks list from FILENAME</span><br><span class="line">  -m FILENAME     Replace default error message <span class="keyword">in</span> boot block with contents of FILENAME</span><br><span class="line">  -M TYPE         Set media <span class="built_in">type</span> <span class="keyword">in</span> boot sector to TYPE</span><br><span class="line">  --mbr[=y|n|a]   Fill (fake) MBR table with one partition <span class="built_in">which</span> spans whole disk</span><br><span class="line">  -n LABEL        Set volume name to LABEL (up to 11 characters long)</span><br><span class="line">  --codepage=N    use DOS codepage N to encode label (default: 850)</span><br><span class="line">  -r COUNT        Make room <span class="keyword">for</span> at least COUNT entries <span class="keyword">in</span> the root directory</span><br><span class="line">  -R COUNT        Set minimal number of reserved sectors to COUNT</span><br><span class="line">  -s COUNT        Set number of sectors per cluster to COUNT</span><br><span class="line">  -S SIZE         Select a sector size of SIZE (a power of two, at least 512)</span><br><span class="line">  -v              Verbose execution</span><br><span class="line">  --variant=TYPE  Select variant TYPE of filesystem (standard or Atari)</span><br><span class="line"></span><br><span class="line">  --invariant     Use constants <span class="keyword">for</span> randomly generated or time based values</span><br><span class="line">  --offset=SECTOR Write the filesystem at a specific sector into the device file.</span><br><span class="line">  --<span class="built_in">help</span>          Show this <span class="built_in">help</span> message and <span class="built_in">exit</span></span><br></pre></td></tr></table></figure><p>‍</p><h1 id="五、使用方法"><a href="#五、使用方法" class="headerlink" title="五、使用方法"></a>五、使用方法</h1><p>快速上手指南</p><h2 id="5-1、PC端下载工具"><a href="#5-1、PC端下载工具" class="headerlink" title="5.1、PC端下载工具"></a>5.1、PC端下载工具</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> http://10.10.10.7/system/app/rtu_server.git</span><br><span class="line"><span class="built_in">cd</span> rtu_server/misc_tools/dostools/__install</span><br><span class="line"></span><br><span class="line">scp -r __install root@192.168.0.224:/</span><br></pre></td></tr></table></figure><h2 id="5-2、板端更新文件"><a href="#5-2、板端更新文件" class="headerlink" title="5.2、板端更新文件"></a>5.2、板端更新文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /</span><br><span class="line"><span class="built_in">cd</span> __install/</span><br><span class="line"><span class="built_in">chmod</span> -R 777 sbin/</span><br><span class="line"><span class="built_in">cp</span> sbin/* /usr/sbin/</span><br><span class="line"></span><br><span class="line">mkfs.fat --<span class="built_in">help</span></span><br></pre></td></tr></table></figure><p>‍</p><h2 id="5-3、实例，格式化sd卡成FAT32"><a href="#5-3、实例，格式化sd卡成FAT32" class="headerlink" title="5.3、实例，格式化sd卡成FAT32"></a>5.3、实例，格式化sd卡成FAT32</h2><p>1）插入sdcard到板端并键入命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkfs.fat -F 32 -n MYSDCARD /dev/mmcblk1p1 </span><br><span class="line">mkfs.fat 4.2 (2021-01-31)</span><br><span class="line">mount /dev/mmcblk1p1 /sdcard/</span><br></pre></td></tr></table></figure><p>​<code>特别注意:</code>​</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">找到sd卡的设备挂载点</span><br><span class="line"></span><br><span class="line">fdisk -l  </span><br><span class="line"></span><br><span class="line">Disk /dev/mmcblk0: 7456 MB, 7818182656 bytes, 15269888 sectors</span><br><span class="line">238592 cylinders, 4 heads, 16 sectors/track</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line"></span><br><span class="line">Disk /dev/mmcblk0 doesn<span class="string">&#x27;t contain a valid partition table</span></span><br><span class="line"><span class="string">Disk /dev/mmcblk0p1: 8 MB, 8388608 bytes, 16384 sectors</span></span><br><span class="line"><span class="string">256 cylinders, 4 heads, 16 sectors/track</span></span><br><span class="line"><span class="string">Units: sectors of 1 * 512 = 512 bytes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Disk /dev/mmcblk0p1 doesn&#x27;</span>t contain a valid partition table</span><br><span class="line">Disk /dev/mmcblk1: 58 GB, 62075699200 bytes, 121241600 sectors</span><br><span class="line"></span><br><span class="line">这里就是 /dev/mmcblk1p1 就是sd卡的挂载点</span><br></pre></td></tr></table></figure><p>2）把卡插回电脑查看</p><p>​<img src="https://siyuannote-991133.oss-cn-shenzhen.aliyuncs.com/Siyuan/image-20240829144816-xbydsay.png" alt="image">​</p><p>​<img src="https://siyuannote-991133.oss-cn-shenzhen.aliyuncs.com/Siyuan/image-20240829145228-6giawkk.png" alt="image">​</p><p>测试用例（略）</p><h1 id="六、总结"><a href="#六、总结" class="headerlink" title="六、总结"></a>六、总结</h1><p>‍</p><p>‍</p><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 项目记录 </category>
          
          <category> 调试记录 </category>
          
          <category> 嵌入式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文件系统 </tag>
            
            <tag> FAT32 </tag>
            
            <tag> SS928 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SS928平台上驱动八寸屏幕调试记录</title>
      <link href="/2024/09/05/cms-ping-mu-b080uan01.3-diao-shi-ji-lu/"/>
      <url>/2024/09/05/cms-ping-mu-b080uan01.3-diao-shi-ji-lu/</url>
      
        <content type="html"><![CDATA[<p>调试过程记录，尽可能用最简洁的话把原理说清楚。</p><h1 id="CMS屏幕-B080UAN01-3-调试记录"><a href="#CMS屏幕-B080UAN01-3-调试记录" class="headerlink" title="CMS屏幕(B080UAN01.3)调试记录"></a>CMS屏幕(B080UAN01.3)调试记录</h1><h1 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a>一、引言</h1><hr><h2 id="1-1、背景"><a href="#1-1、背景" class="headerlink" title="1.1、背景"></a>1.1、背景</h2><p>CMS项目，屏幕驱动，双屏异显示。</p><h2 id="1-2、文章目的"><a href="#1-2、文章目的" class="headerlink" title="1.2、文章目的"></a>1.2、文章目的</h2><p>关键过程记录，原理记录，快速上手。<strong>测试人员或者电子工程师验证屏幕点亮情况，可以直接参考第五章</strong>。</p><p>如果不想看详细记录，请直接移步第五章，快速上手。</p><h1 id="二、项目概述"><a href="#二、项目概述" class="headerlink" title="二、项目概述"></a>二、项目概述</h1><hr><h2 id="2-1、功能简介"><a href="#2-1、功能简介" class="headerlink" title="2.1、功能简介"></a>2.1、功能简介</h2><p>把屏幕驱动起来，显示动画。</p><p>读取本地文件解码然后播放，在屏幕上播放。</p><h1 id="三、环境准备"><a href="#三、环境准备" class="headerlink" title="三、环境准备"></a>三、环境准备</h1><hr><h2 id="3-1、产品需求"><a href="#3-1、产品需求" class="headerlink" title="3.1、产品需求"></a>3.1、产品需求</h2><p>CMS项目，屏幕驱动，双屏异显示。</p><h2 id="3-2、硬件配置"><a href="#3-2、硬件配置" class="headerlink" title="3.2、硬件配置"></a>3.2、硬件配置</h2><h3 id="1）八寸屏幕"><a href="#1）八寸屏幕" class="headerlink" title="1）八寸屏幕"></a>1）八寸屏幕</h3><p>资料请看（<del>没什么大作用</del>）</p><p>产品简介：B080UAN01_3_MIPI_Primilary_Functional_Spec_0.6.pdf</p><p>​<code>产品：8.0” WUXGA 16:10 Color TFT-LCD with LED Backlight design</code>​</p><p>​<code>型号：B080UAN01.3 (H/W 0A)</code>​</p><h3 id="2）M2-SS928主板"><a href="#2）M2-SS928主板" class="headerlink" title="2）M2 SS928主板"></a>2）M2 SS928主板</h3><p>​<img src="https://siyuannote-991133.oss-cn-shenzhen.aliyuncs.com/Siyuan/image-20240830202335-ezfxy7n.png" alt="image">​</p><h3 id="3）屏幕和主板接口"><a href="#3）屏幕和主板接口" class="headerlink" title="3）屏幕和主板接口"></a>3）屏幕和主板接口</h3><p>​<img src="https://siyuannote-991133.oss-cn-shenzhen.aliyuncs.com/Siyuan/image-20240830102045-6upungr.png" alt="image">​</p><h2 id="3-3、软件配置"><a href="#3-3、软件配置" class="headerlink" title="3.3、软件配置"></a>3.3、软件配置</h2><p>请将M2卡的刷包写入设备中，以确保板子正常运行。同时，请开启SSH和Telnet登录功能，确保USB虚拟网卡能够正常工作，以保障系统的网络连接稳定性和可访问性。把M2的卡刷包刷进去，确保板子工作是正常的。</p><h1 id="四、实现要点"><a href="#四、实现要点" class="headerlink" title="四、实现要点"></a>四、实现要点</h1><hr><p>关键步骤或代码示例</p><p>主要参考《屏幕对接 使用指南》和MPP参考文档以及计算器。</p><p>严格按照这个配置流程走：</p><p>​<img src="https://siyuannote-991133.oss-cn-shenzhen.aliyuncs.com/Siyuan/image-20240830203651-kgklrrw.png" alt="image">​</p><h2 id="4-1、供电（点亮背光）"><a href="#4-1、供电（点亮背光）" class="headerlink" title="4.1、供电（点亮背光）"></a>4.1、供电（点亮背光）</h2><p>参考《21AP10_PINOUT_CN.xlsx》参考表格将相关GPIO状态设置完整。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//LCD power, 1-enable 0-disable</span><br><span class="line">bspmm 0x0102F0110 0x00001201</span><br><span class="line">echo 85 &gt; /sys/class/gpio/export</span><br><span class="line">echo out &gt; /sys/class/gpio/gpio85/direction</span><br><span class="line">echo 1 &gt; /sys/class/gpio/gpio85/value</span><br><span class="line"></span><br><span class="line">//lcd reset, 0 - active reset ; 1-normal</span><br><span class="line">bspmm 0x0102F0110 0x00001201</span><br><span class="line">echo 84 &gt; /sys/class/gpio/export</span><br><span class="line">echo out &gt; /sys/class/gpio/gpio84/direction</span><br><span class="line">echo 0 &gt; /sys/class/gpio/gpio84/value</span><br><span class="line">sleep 1;</span><br><span class="line">echo 1 &gt; /sys/class/gpio/gpio84/value</span><br><span class="line"></span><br><span class="line">//backlight pwm</span><br><span class="line">bspmm 0x0102F0104 0x00001201</span><br><span class="line">echo 82 &gt; /sys/class/gpio/export</span><br><span class="line">echo out &gt; /sys/class/gpio/gpio82/direction</span><br><span class="line">echo 1 &gt; /sys/class/gpio/gpio82/value</span><br></pre></td></tr></table></figure><h2 id="4-2、时序"><a href="#4-2、时序" class="headerlink" title="4.2、时序"></a>4.2、时序</h2><p>这里说的时序是指同步时序，用来计算pixek clock的。</p><p>​<img src="https://siyuannote-991133.oss-cn-shenzhen.aliyuncs.com/Siyuan/image-20240830204217-d07chti.png" alt="image">​</p><p>另外同步时序用这个：(从下面拷贝来的）</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.combo_dev_cfg = &#123;</span><br><span class="line">            .devno = <span class="number">0</span>,</span><br><span class="line">            .lane_id = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;,</span><br><span class="line">            .out_mode = OUT_MODE_DSI_VIDEO,</span><br><span class="line">            .out_format = OUT_FORMAT_RGB_24BIT,</span><br><span class="line">            .video_mode =  BURST_MODE,</span><br><span class="line">            .sync_info = &#123;</span><br><span class="line">                .hsa_pixels = <span class="number">10</span>, <span class="comment">/* 24 pixel */</span></span><br><span class="line">                .hbp_pixels = <span class="number">50</span>, <span class="comment">/* 80 pixel */</span></span><br><span class="line">                .hact_pixels = <span class="number">1200</span>, <span class="comment">/* 1200 pixel */</span></span><br><span class="line">                .hfp_pixels = <span class="number">30</span>, <span class="comment">/* 60 pixel */</span></span><br><span class="line">                .vsa_lines = <span class="number">2</span>, <span class="comment">/* 2 line */</span></span><br><span class="line">                .vbp_lines = <span class="number">3</span>, <span class="comment">/* 10 line */</span></span><br><span class="line">                .vact_lines = <span class="number">1920</span>, <span class="comment">/* 1920 line */</span></span><br><span class="line">                .vfp_lines = <span class="number">15</span>, <span class="comment">/* 15 line */</span></span><br><span class="line">            &#125;,</span><br><span class="line">            .phy_data_rate = <span class="number">901</span>,</span><br><span class="line">            .pixel_clk = <span class="number">150156</span>,</span><br><span class="line">        &#125;,</span><br></pre></td></tr></table></figure><h3 id="更新一个稳定点亮的配置："><a href="#更新一个稳定点亮的配置：" class="headerlink" title="更新一个稳定点亮的配置："></a>更新一个稳定点亮的配置：</h3><p>PS：这个配置是 <code>.devno = 1</code>​的情况。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hi_vo_sync_info sync_info;</span><br><span class="line">hi_vo_user_sync_info user_sync;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">.user_sync = &#123;</span><br><span class="line">            .user_sync_attr = &#123;</span><br><span class="line">                .clk_src = OT_VO_CLK_SRC_FIXED,</span><br><span class="line">                <span class="comment">// .vo_pll = &#123; /* if hdmi, set it by pixel clk and div mode */</span></span><br><span class="line">                <span class="comment">//     .fb_div = 100, /* 80 fb div */</span></span><br><span class="line">                <span class="comment">//     .frac = 0x27EF9D,</span></span><br><span class="line">                <span class="comment">//     .ref_div = 1, /* 1 ref div */</span></span><br><span class="line">                <span class="comment">//     .post_div1 = 4, /* 6 post div1 */</span></span><br><span class="line">                <span class="comment">//     .post_div2 = 2, /* 2 post div2 */</span></span><br><span class="line">                <span class="comment">// &#125;,</span></span><br><span class="line">                .lcd_m_clk_div = OT_VO_FIXED_CLK_148_5M</span><br><span class="line">            &#125;,</span><br><span class="line">            .pre_div = <span class="number">1</span>, <span class="comment">/* if hdmi, set it by pixel clk */</span></span><br><span class="line">            .dev_div = <span class="number">1</span>, <span class="comment">/* if rgb, set it by serial mode */</span></span><br><span class="line">            .clk_reverse_en = HI_FALSE,</span><br><span class="line">        &#125;,</span><br><span class="line">        .dev_frame_rate = <span class="number">60</span>,</span><br></pre></td></tr></table></figure><h2 id="4-3、SOC平台配置"><a href="#4-3、SOC平台配置" class="headerlink" title="4.3、SOC平台配置"></a>4.3、SOC平台配置</h2><p>综上所述，在配置视频输出时，需要特别关注常规显示屏的初始化命令。与一般屏幕不同，该屏幕已内置相应命令，因此只需配置<strong>video</strong>参数即可。具体配置细节请参见相关文档以获取更多信息。详见配置：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">const</span> sample_vo_mipi_tx_cfg g_vo_tx_cfg_1200x1920_user = &#123;</span><br><span class="line">    .vo_config = &#123;</span><br><span class="line">        .vo_dev = SAMPLE_VO_DEV_HD, <span class="comment">//这里是1</span></span><br><span class="line">        .vo_intf_type = HI_VO_INTF_MIPI,</span><br><span class="line">        .intf_sync = HI_VO_OUT_USER,</span><br><span class="line">        .bg_color = COLOR_RGB_RED,</span><br><span class="line">        .pix_format = HI_PIXEL_FORMAT_YVU_SEMIPLANAR_420,</span><br><span class="line">        .disp_rect = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">1200</span>, <span class="number">1920</span>&#125;,</span><br><span class="line">        .image_size = &#123;<span class="number">1200</span>, <span class="number">1920</span>&#125;,</span><br><span class="line">        .vo_part_mode = HI_VO_PARTITION_MODE_SINGLE,</span><br><span class="line">        .dis_buf_len = <span class="number">3</span>, <span class="comment">/* 3: def buf len for single */</span></span><br><span class="line">        .dst_dynamic_range = HI_DYNAMIC_RANGE_SDR8,</span><br><span class="line">        .vo_mode = VO_MODE_1MUX,</span><br><span class="line">        .compress_mode = HI_COMPRESS_MODE_NONE,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// .sync_info = &#123;0, 1, 1, 1920, 6, 16, 1200, 58, 130, 1, 10, 9, 7, 50, 2, 0, 0, 0&#125;,</span></span><br><span class="line">        .sync_info = &#123;</span><br><span class="line">            .syncm = <span class="number">0</span>,</span><br><span class="line">            .iop = <span class="number">1</span>,</span><br><span class="line">            .intfb = <span class="number">1</span>,</span><br><span class="line">            .vact = <span class="number">1920</span>,</span><br><span class="line">            .vbb = <span class="number">5</span>,</span><br><span class="line">            .vfb = <span class="number">15</span>,</span><br><span class="line">            .hact = <span class="number">1200</span>,</span><br><span class="line">            .hbb = <span class="number">60</span>,</span><br><span class="line">            .hfb = <span class="number">30</span>,</span><br><span class="line">            .hmid = <span class="number">1</span>,</span><br><span class="line">            .bvact = <span class="number">10</span>,</span><br><span class="line">            .bvbb = <span class="number">9</span>,</span><br><span class="line">            .bvfb = <span class="number">7</span>,</span><br><span class="line">            .hpw = <span class="number">10</span>,</span><br><span class="line">            .vpw = <span class="number">2</span>,</span><br><span class="line">            .idv = <span class="number">0</span>,</span><br><span class="line">            .ihs = <span class="number">0</span>,</span><br><span class="line">            .ivs = <span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        .user_sync = &#123;</span><br><span class="line">            .user_sync_attr = &#123;</span><br><span class="line">                .clk_src = OT_VO_CLK_SRC_FIXED,</span><br><span class="line">                <span class="comment">// .vo_pll = &#123; /* if hdmi, set it by pixel clk and div mode */</span></span><br><span class="line">                <span class="comment">//     .fb_div = 100, /* 80 fb div */</span></span><br><span class="line">                <span class="comment">//     .frac = 0x27EF9D,</span></span><br><span class="line">                <span class="comment">//     .ref_div = 1, /* 1 ref div */</span></span><br><span class="line">                <span class="comment">//     .post_div1 = 4, /* 6 post div1 */</span></span><br><span class="line">                <span class="comment">//     .post_div2 = 2, /* 2 post div2 */</span></span><br><span class="line">                <span class="comment">// &#125;,</span></span><br><span class="line">                .lcd_m_clk_div = OT_VO_FIXED_CLK_148_5M</span><br><span class="line">            &#125;,</span><br><span class="line">            .pre_div = <span class="number">1</span>, <span class="comment">/* if hdmi, set it by pixel clk */</span></span><br><span class="line">            .dev_div = <span class="number">1</span>, <span class="comment">/* if rgb, set it by serial mode */</span></span><br><span class="line">            .clk_reverse_en = HI_FALSE,</span><br><span class="line">        &#125;,</span><br><span class="line">        .dev_frame_rate = <span class="number">60</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    .tx_config = &#123;</span><br><span class="line">        <span class="comment">/* for combo dev config */</span></span><br><span class="line">        .intf_sync = HI_MIPI_TX_OUT_USER,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* for screen cmd */</span></span><br><span class="line">        <span class="comment">// .cmd_count = CMD_COUNT_1200X1920,</span></span><br><span class="line">        <span class="comment">// .cmd_info = g_cmd_info_1200x1920,</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/* for user sync */</span></span><br><span class="line">        .combo_dev_cfg = &#123;</span><br><span class="line">            .devno = <span class="number">0</span>,</span><br><span class="line">            .lane_id = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;,</span><br><span class="line">            .out_mode = OUT_MODE_DSI_VIDEO,</span><br><span class="line">            .out_format = OUT_FORMAT_RGB_24BIT,</span><br><span class="line">            .video_mode =  BURST_MODE,</span><br><span class="line">            .sync_info = &#123;</span><br><span class="line">                .hsa_pixels = <span class="number">10</span>, <span class="comment">/* 24 pixel */</span></span><br><span class="line">                .hbp_pixels = <span class="number">50</span>, <span class="comment">/* 80 pixel */</span></span><br><span class="line">                .hact_pixels = <span class="number">1200</span>, <span class="comment">/* 1200 pixel */</span></span><br><span class="line">                .hfp_pixels = <span class="number">30</span>, <span class="comment">/* 60 pixel */</span></span><br><span class="line">                .vsa_lines = <span class="number">2</span>, <span class="comment">/* 2 line */</span></span><br><span class="line">                .vbp_lines = <span class="number">3</span>, <span class="comment">/* 10 line */</span></span><br><span class="line">                .vact_lines = <span class="number">1920</span>, <span class="comment">/* 1920 line */</span></span><br><span class="line">                .vfp_lines = <span class="number">15</span>, <span class="comment">/* 15 line */</span></span><br><span class="line">            &#125;,</span><br><span class="line">            .phy_data_rate = <span class="number">901</span>,</span><br><span class="line">            .pixel_clk = <span class="number">150156</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="时钟源（都是user-sync-attr里面的时钟源详细来源）"><a href="#时钟源（都是user-sync-attr里面的时钟源详细来源）" class="headerlink" title="时钟源（都是user_sync_attr里面的时钟源详细来源）"></a>时钟源（都是user_sync_attr里面的时钟源详细来源）</h3><p>​<img src="https://siyuannote-991133.oss-cn-shenzhen.aliyuncs.com/Siyuan/image-20240827144220-9v8r6uj.png" alt="image">​</p><p>​<img src="https://siyuannote-991133.oss-cn-shenzhen.aliyuncs.com/Siyuan/image-20240827144005-vcis5ai.png" alt="image">​</p><p>​<img src="https://siyuannote-991133.oss-cn-shenzhen.aliyuncs.com/Siyuan/image-20240827144501-t9ic6gh.png" alt="image">​</p><p>‍</p><h1 id="五、使用方法"><a href="#五、使用方法" class="headerlink" title="五、使用方法"></a>五、使用方法</h1><hr><p>快速上手指南</p><p>见测试用例。</p><p>测试用例</p><h2 id="5-2、屏幕的单元测试"><a href="#5-2、屏幕的单元测试" class="headerlink" title="5.2、屏幕的单元测试"></a>5.2、屏幕的单元测试</h2><h3 id="1）把测试依赖文件传到板端"><a href="#1）把测试依赖文件传到板端" class="headerlink" title="1）把测试依赖文件传到板端"></a>1）把测试依赖文件传到板端</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">scp <span class="literal">-r</span> .\aodicms root@<span class="number">192.168</span>.<span class="number">2.249</span>:/aoditest</span><br><span class="line"></span><br><span class="line">ssh root@<span class="number">192.168</span>.<span class="number">2.249</span></span><br><span class="line"></span><br><span class="line">（改了目录名）</span><br></pre></td></tr></table></figure><h3 id="2）在板端运行命令"><a href="#2）在板端运行命令" class="headerlink" title="2）在板端运行命令"></a>2）在板端运行命令</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Welcome to Linux.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> 777 -R aoditest/</span><br><span class="line"><span class="built_in">cd</span> /aoditest/</span><br><span class="line">./run.sh</span><br><span class="line"></span><br><span class="line">日志：</span><br><span class="line">start vo dhd0.</span><br><span class="line">mipi intf <span class="built_in">sync</span> = 48</span><br><span class="line"></span><br><span class="line">_sample_test:press <span class="string">&#x27;e&#x27;</span> to <span class="built_in">exit</span>; <span class="string">&#x27;q&#x27;</span> to query!;</span><br><span class="line"></span><br><span class="line">  chn 0, stream file:3840x2160_8bit.h264, userbufsize: 12441600</span><br><span class="line"> chn 0 send steam thread <span class="built_in">return</span> ...</span><br><span class="line">[Func]:mpi_hdmi_com_stop [Line]:444 [Info]:hdmi:0 <span class="keyword">do</span> NOT open</span><br><span class="line">hi_mpi_hdmi_stop failed at sample_comm_vo_hdmi_stop: LINE: 543 with 0xa0288004!</span><br><span class="line">[main]-957: program <span class="built_in">exit</span> normally!</span><br><span class="line">sample_vdec exited gracefully</span><br><span class="line">start vo dhd0.</span><br><span class="line">mipi intf <span class="built_in">sync</span> = 48</span><br><span class="line"></span><br><span class="line">_sample_test:press <span class="string">&#x27;e&#x27;</span> to <span class="built_in">exit</span>; <span class="string">&#x27;q&#x27;</span> to query!;</span><br><span class="line"></span><br><span class="line">  chn 0, stream file:3840x2160_8bit.h264, userbufsize: 12441600</span><br></pre></td></tr></table></figure><h3 id="3）预期测试结果："><a href="#3）预期测试结果：" class="headerlink" title="3）预期测试结果："></a>3）预期测试结果：</h3><p>​<img src="https://siyuannote-991133.oss-cn-shenzhen.aliyuncs.com/Siyuan/1725000348848-20240830144555-62y15xn.png" alt="1725000348848">​</p><h1 id="六、参考资料"><a href="#六、参考资料" class="headerlink" title="六、参考资料"></a>六、参考资料</h1><ol><li>《21AP10_PINOUT_CN.xlsx》 - 该文档详细列出了21AP10接口的引脚定义。</li><li>《RGB_MIPI屏幕时钟时序计算器.xlsx》 - 一个用于计算RGB MIPI屏幕时序的实用工具。</li><li>《MPP 媒体处理软件 V5.0 开发参考.pdf》 - 与MPP媒体处理软件相关的开发文档。</li><li>《屏幕对接 使用指南.pdf》 - 关于如何连接屏幕的详细使用指南。</li></ol><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 项目记录 </category>
          
          <category> 调试记录 </category>
          
          <category> 嵌入式音视频 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SS928 </tag>
            
            <tag> CMS </tag>
            
            <tag> 屏幕驱动 </tag>
            
            <tag> MIPI </tag>
            
            <tag> 海思MPP </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
